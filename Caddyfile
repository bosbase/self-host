# Caddy Configuration for Single-Node BosBase Deployment
# Place this file in /etc/caddy/Caddyfile

yourdomain.com {
 

    # Handle /booster* requests to port 2678
    handle /booster* {
        reverse_proxy localhost:2678 {
            header_up Upgrade {http.upgrade}
            header_up Connection {http.connection}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-Host {host}

            transport http {
                max_conns_per_host 0
            }
        }
    }



    # Handle all other requests
    handle {
        reverse_proxy localhost:8090 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            header_up X-Forwarded-Host {host}

            transport http {
                max_conns_per_host 0
            }
        }
    }

    # Logging
    log {
        output file /var/log/caddy/bosbase.log
        format json
    }
}

# Redirect www to non-www
www.yourdomain.com {
    redir https://yourdomain.com{uri} permanent
}

